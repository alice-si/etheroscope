<search-bar>
</search-bar>
<!-- Help Message without a graph -->
<div class="no-graph" *ngIf="curDisplayState === DisplayState.noContract" (click)="userSearching = false;">
    <p *ngIf="curDisplayState === DisplayState.noContract" class="animated fadeInUp">
        <clr-icon shape="arrow" size="36"></clr-icon><br> First, enter a contract to explore. This could be a contract's hash, or a name the contract is associated with.<br> Click <u><a (click)="exploreContract('0xBd897c8885b40d014Fb7941B3043B21adcC9ca1C')">here</a></u> to see an example!<br><br><br><br>
        <clr-icon shape="scroll" size="36"></clr-icon>
        <clr-icon shape="arrow" dir="right" size="36"></clr-icon>
        <clr-icon shape="scroll" size="36"></clr-icon>
        <clr-icon shape="arrow" dir="right" size="36"></clr-icon>
        <clr-icon shape="scroll" size="36"></clr-icon>
        <clr-icon shape="arrow" dir="right" size="36"></clr-icon>
        <clr-icon shape="scroll" size="36"></clr-icon>
        <clr-icon shape="arrow" dir="right" size="36"></clr-icon>
        <clr-icon shape="scroll" size="36"></clr-icon>
        <clr-icon shape="arrow" dir="right" size="36"></clr-icon>
        <clr-icon shape="scroll" size="36"></clr-icon> <br><br> Each block in the blockchain comes with a unique hash.<br> However, make sure that the hash is associated with a smart contract.
    </p>
    <br>
</div>

<!-- basic state when user indicates a contract -->
<table *ngIf="curDisplayState !== DisplayState.noContract" class="graph-table" (click)="userSearching = false;">
    <tr>
        <td class="graph-td">
            <div class="graph-area animated fadeIn" *ngIf="curDisplayState === DisplayState.displayingGraph && graphDatapoints.length !== 0">
                <ngx-charts-line-chart [scheme]="colorScheme" [results]="multi" [gradient]="gradient" [xAxis]="showXAxis" [yAxis]="showYAxis" [legend]="showLegend" [showXAxisLabel]="showXAxisLabel" [showYAxisLabel]="showYAxisLabel" [xAxisLabel]="xAxisLabel" [yAxisLabel]="yAxisLabel" [autoScale]="autoScale" [timeline]=true>
                </ngx-charts-line-chart>
            </div>
            <div class="no-graph-but-var animated fadeInLeft" *ngIf="curDisplayState === DisplayState.newContract">
                <p> Then choose a variable you want to look at
                    <clr-icon shape="arrow" size="36" dir="right"></clr-icon><br><br> </p>
                <p>A smart contract may come with certain publicly exposed variables.<br>For example, a charity might make public the amount of money it has donated.<br>Choose a variable you want to see the history of.</p>
            </div>
            <div class="no-graph-with-var animated fadeIn" *ngIf="curDisplayState === DisplayState.displayingGraph && graphDatapoints.length === 0">
                <p> There are no points to display </p>
            </div>
            <div class="no-graph-with-var" *ngIf="curDisplayState === DisplayState.awaitingInitialPoints">
                <div class="ngwv-w">
                    <p>
                        Finding the first datapoints
                    </p>
                    <div class="progress loop"><progress></progress></div>
                </div>
            </div>
        </td>
        <td class="cards-td" align="right">
            <div class="animated fadeIn">
                <div class="card" id="variables">
                    <div class="card-header" *ngIf="this.curContractName.length <= 25">
                        Contract: {{this.curContractName}}
                    </div>
                    <div class="card-header" *ngIf="this.curContractName.length > 25" [title]="this.curContractName">
                        Contract: {{this.curContractName.slice(0,22)}}...
                    </div>
                    <div class="card-block">
                        <table>
                            <tr>
                                <td style="padding: 0;">
                                    <div class="card-text" style="text-align: center; font-size: 0.9em;">
                                        Address: {{this.curContractID.substr(0, 20)}}...
                                    </div>
                                </td>
                                <td align="right">
                                    <button class="btn btn-icon btn-link" style="margin:0;" title="Click to copy the address!" (click)="copyToClipboard(this.curContractID)">
                                      <clr-icon shape="copy" style="color: #1998a2"></clr-icon>
                                    </button>
                                </td>
                            </tr>
                        </table>
                        <div id="viewSourceCode" style="text-align: center;" *ngIf="this.curContractName !== 'unknown'">
                            <button class="btn btn-sm view-src-btn" (click)="openSourceCode()">View the contract's source code</button>
                        </div>
                    </div>
                    <div class="card-block">
                        <div class="card-text" *ngIf="relevantMethods.length === 0">
                            No displayable variables in contract
                        </div>
                        <div class="card-text" *ngIf="relevantMethods.length !== 0">
                            <div style="text-align: center;">
                                Click to view a variable:
                            </div>
                            <button class="btn btn-sm var-btns animated fadeIn" *ngFor="let m of relevantMethods" (click)="generateDatapoints(m)">
                          <div *ngIf="m.length <= 15"> {{m}} </div>
                          <div *ngIf="m.length >= 16" title="{{m}}"> {{m.slice(0,13)}}..  </div>
                        </button>
                            <br>
                            <div *ngIf="methodPages > 1" style="text-align: center">
                                <button class="btn btn-link" (click)="methodsScroll(true)">
                              <clr-icon shape="arrow left"></clr-icon>
                            </button>
                                <span>{{variableScroll + 1}} / {{methodPages}} &nbsp; </span>
                                <button class="btn btn-link" (click)="methodsScroll(false)">
                              <clr-icon shape="arrow right"></clr-icon>
                            </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card currViewing animated fadeIn" *ngIf="curDisplayState === DisplayState.displayingGraph || curDisplayState === DisplayState.awaitingInitialPoints">
                <div class="card-header">
                    Currently Viewing Variable
                </div>
                <div class="card-block">
                    <button class="btn-primary btn btn-sm" style="cursor: default;">
                      {{this.lastMethod}}
                    </button>
                </div>
                <div *ngIf="progressBar !== 100" class="card-block progress-card">
                    <div class="progress-block">
                        <label>{{this.progressBar}}%</label>
                        <div class="progress-static">
                            <div class="progress-meter" [attr.data-value]="progressBar"></div>
                        </div>
                    </div>
                    <div class="card-text from-block-to-block">
                        Got points from block {{this.cachedFrom}} to {{this.cachedTo}}
                    </div>
                </div>
                <div class="card-block" *ngIf="datapointFilters !== undefined && datapointFilters.length !== 0">
                    <div class="card-text" *ngFor="let filter of datapointFilters; let i = index">
                        {{filter.message}}
                        <clr-icon shape="times" style="cursor:pointer;" (click)="deleteFilter(i)"></clr-icon>
                    </div>
                </div>
            </div>
            <div class="card filters animated fadeIn" *ngIf="curDisplayState === DisplayState.displayingGraph">
                <div class="card-header">
                    Filter the points on the graph
                </div>
                <div class="card-block">
                    <div class="btn-group btn-primary">
                        <button (click)="filterOnLast(1, 'hour')">1h</button>
                        <button (click)="filterOnLast(12, 'hour')">12h</button>
                        <button (click)="filterOnLast(1, 'day')">1d</button>
                        <button (click)="filterOnLast(1, 'week')">1w</button>
                        <button (click)="filterOnLast(1, 'month')">1m</button>
                        <button (click)="filterOnLast(1, 'year')">1y</button>
                    </div>
                </div>
                <div class="card-block">
                    <div class="card-text container" style="text-align: left">

                        <form #f="ngForm" (ngSubmit)="newFilterFromForm(f.value)">
                            <section class="form-block">
                                <div class="section">
                                </div>
                                <div class="form-group row">
                                    <div for="startDate" class="col-xs-12"> Starting from date: </div>
                                    <input type="datetime-local" class="col-xs-12" id="startDate" name="startDate" ngModel>
                                </div>
                                <div class="form-group row">
                                    <div for="endDate" class="col-xs-12">
                                        Ending at date:
                                    </div>
                                    <input type="datetime-local" class="col-xs-12" id="endDate" name="endDate" ngModel>
                                </div>
                                <div class="row">
                                    <button type="submit" class="btn btn-primary btn-sm btn-submit">Filter</button>
                                </div>
                            </section>
                        </form>

                    </div>
                </div>
            </div>
        </td>
    </tr>
</table>
